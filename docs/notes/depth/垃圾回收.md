
# 垃圾回收

### 垃圾回收算法
- 之前：引用计数，没有被引用就清除，但是循环引用的情况会有缺陷
- 现在：标记清除，会定时循环根 window 对象，看是否还有标记，没有就清除

### 内存泄漏（Memory Leak）
`内存泄漏`是指程序中已动态分配的堆内存由于某种原因程序未释放或无法释放，造成系统内存的浪费，导致程序运行速度减慢甚至系统崩溃等严重后果。

### 内存泄漏场景
- 被全局变量、函数引用，组件销毁时未清除
- 被全局事件、定时器引用，组件销毁时未清除
- 被自定义事件引用，组件销毁时未清除

### 闭包是内存泄漏？
- 不符合预期，没有被销毁的才是内存泄漏
- 闭包虽然不会被垃圾回收机制回收，但是闭包是符合我们预期，不被销毁的，所以闭包不属于内存泄漏

### JS内存泄漏如何检测
- 使用 performance 检测， 看是否某个地方突然内存增加很多并且没有减回去
- 正常情况是上上下下，内存增加销毁、增加销毁~~

<img :src="$withBase('/assets/notes-images/depth/performance.png')" alt="performance" width="800">

### 闭包是什么？
当面试官问到一个比较大的问题的时候，可以参照一下三部曲进行回答：
- 解释它是什么
- 该技术的应用点、应用场景
- 优缺点是什么


根据上面的三部曲，可以这么回答： 
1. 是什么：闭包就是能够访问其他函数内部变量的函数。

2. 应用点、应用场景： 
- 闭包一般会在封装模块的时候，通过函数自执行函数的方式进行实现
- 或者在模仿块级作用域的时候实现
- 比如：我们常用的库jQuery本身就是一个大的闭包

3. 优缺点：
- 闭包的优点
    + 能够在离开函数之后继续访问该函数的变量，变量一直保存在内存中
    + 闭包中的变量是私有的，只有闭包函数才有权限访问它，不会被外面的变量和方法污染
- 闭包的缺点
    + 会增加对内存的使用量，影响性能
    + 不正确的使用闭包会造成内存泄漏


